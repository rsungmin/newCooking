<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="Recipe">
	<insert id="insertRecipe1" parameterType="recipebean">
		INSERT INTO TBL_RECIPE
		VALUES(recipe_SEQ.NEXTVAL,#{rc_title},#{rc_contents},
		#{rc_cate},#{rc_info},#{rc_time},#{rc_dif},SYSDATE,0,'apple1',1,0,#{rc_file_title},
		1,#{st_content},'st_tip','st_file_name',#{in_name},'in_amount')
	</insert>
  	<insert id="insertRecipe" parameterType="recipebean">
  		INSERT INTO TBL_RECIPE 
  		(RC_NUM, RC_TITLE, RC_CONTENTS, RC_CATE, RC_INFO, RC_TIME,
  		 RC_DIF, RC_DATE, RC_VIEWCNT, MEMBER_ID, MEMBER_NUM, RC_LIKE, 
  		 RC_FILE_TITLE, ST_CONTENT, IN_NAME)
  		VALUES(recipe_SEQ.NEXTVAL,#{rc_title},#{rc_contents}, #{rc_cate},#{rc_info},#{rc_time},
  		#{rc_dif},SYSDATE, 0, 'apple1', 1, 0, #{rc_file_title}, #{st_content}, #{in_name})
  	</insert>
  	<!-- 게시글 추천 -->
  	<insert id="recUpdate" parameterType="hashmap">
  		INSERT INTO TBL_LIKE VALUES(LIKE_SEQ.NEXTVAL, #{member_id}, ${rc_num})
  	</insert>
  	
	<select id="RecipeSeq" resultType="_int">
		SELECT recipe_SEQ.CURRVAL FROM DUAL
	</select>
	<select id="RecipeCnt" resultType="_int">
		SELECT COUNT(*) FROM TBL_RECIPE	
	</select>
	
	<select id="listAll" parameterType="hashmap" resultType="recipebean">
		 SELECT * FROM
			(SELECT ROWNUM r, d.*
			FROM (SELECT * FROM TBL_RECIPE ORDER BY RC_NUM DESC) d) b
		WHERE b.r BETWEEN ${startRow} AND ${endRow}		
	</select>
	<select id="listKor" parameterType="hashmap" resultType="recipebean">
		 SELECT * FROM
			(SELECT ROWNUM r, d.*
			FROM (SELECT * FROM TBL_RECIPE WHERE RC_CATE='한식' ORDER BY RC_NUM DESC) d) b
		WHERE b.r BETWEEN ${startRow} AND ${endRow}		
	</select>
	<!-- 메인 리스트 가져오기 -->
	<select id="listMain" resultType="recipebean">
		SELECT * FROM 
			(SELECT * FROM TBL_RECIPE ORDER BY RC_LIKE DESC) 
		<![CDATA[WHERE ROWNUM <= 3]]>
	</select>
	<select id="getDetail" parameterType="_int" resultType="recipebean">
		SELECT * FROM TBL_RECIPE WHERE RC_NUM = ${rc_num}
	</select>
	<!--동일게시글 추천여부 검색  -->
	<select id="recCheck" parameterType="hashmap" resultType="_int">
		SELECT COUNT(*) FROM TBL_LIKE WHERE RC_NUM = #{rc_num} AND MEMBER_ID = #{member_id}
	</select>
	<!-- 게시글 추천수 -->
	<select id="recCount" parameterType="_int" resultType="_int">
		SELECT COUNT(*) FROM TBL_LIKE WHERE RC_NUM=#{rc_num}
	</select>
	<!-- 조회수 증가 -->
  	<update id="updateViewCnt" parameterType="_int">
		UPDATE TBL_RECIPE SET RC_VIEWCNT = RC_VIEWCNT+1
		WHERE RC_NUM=${rc_num}
	</update>
	<!-- 좋아요 수 증가 -->
	<update id="updateLikeCnt" parameterType="_int">
		UPDATE TBL_RECIPE SET RC_LIKE = RC_LIKE+1
		WHERE RC_NUM=${rc_num}
	</update>
	<update id="updateRecipe" parameterType="recipebean">
		UPDATE TBL_RECIPE SET 
			RC_NUM=#{rc_num}, RC_TITLE=#{rc_title}, RC_CONTENTS=#{rc_contents}, 
			RC_CATE=#{rc_cate}, RC_INFO=#{rc_info}, RC_TIME=#{rc_time}, RC_DIF=#{rc_dif}, 
			RC_DATE=SYSDATE, RC_VIEWCNT=1, MEMBER_ID='apple1', MEMBER_NUM=1, RC_LIKE=1, 
			RC_FILE_TITLE=#{rc_file_title}, ST_CONTENT=#{st_content}, IN_NAME=#{in_name} 
		WHERE RC_NUM=${rc_num}
	</update>
	<delete id="deleteRecipe" parameterType="_int">
		DELETE FROM TBL_RECIPE WHERE RC_NUM=${rc_num}
	</delete>
	<!-- 게시글 추천 취소 -->
	<delete id="recDelete" parameterType="hashmap">
		DELETE FROM TBL_LIKE WHERE RC_NUM =#{rc_num} AND MEMBER_ID=#{member_id}
	</delete>
	
	
	
	
	
	<select id="getReply" parameterType="_int" resultType="replybean">
		SELECT * FROM TBL_REPLY WHERE RC_NUM=${rc_num}
	</select>
	<insert id="insertReply" parameterType="replybean">
   		INSERT INTO TBL_REPLY 
   		VALUES(reply_seq.NEXTVAL, #{reply_contents}, #{member_id}, #{rc_num}, #{reply_file_name})
   </insert>
   
   <update id="updateReply" parameterType="hashmap" >
   		UPDATE TBL_REPLY SET REPLY_CONTENTS=#{reply_contents} WHERE REPLY_NUM=${reply_num}
   </update>
   
   <delete id="deleteReply" parameterType="_int">
   		DELETE FROM TBL_REPLY WHERE REPLY_NUM=${reply_num}
   </delete>
  </mapper>